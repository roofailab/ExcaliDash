services:
  # Local OIDC provider for development (Keycloak).
  #
  # Usage:
  #   docker compose -f docker-compose.oidc.yml up -d
  #
  # Keycloak Admin UI:
  #   http://localhost:8080/admin
  keycloak:
    # Pin the default image for reproducible local dev.
    # Override if needed: `export KEYCLOAK_IMAGE=quay.io/keycloak/keycloak:<version>`
    image: ${KEYCLOAK_IMAGE:-quay.io/keycloak/keycloak:24.0.5}
    command: ["start-dev", "--import-realm"]
    environment:
      - KEYCLOAK_ADMIN=${KEYCLOAK_ADMIN:-admin}
      - KEYCLOAK_ADMIN_PASSWORD=${KEYCLOAK_ADMIN_PASSWORD:?set KEYCLOAK_ADMIN_PASSWORD in your shell or .env (do not commit it)}
    ports:
      - "8080:8080"
    volumes:
      - ./oidc/keycloak/realm-excalidash.json:/opt/keycloak/data/import/realm-excalidash.json:ro
    restart: unless-stopped

2026-02-24: Added API_KEYS env var support. Added `# CI / API Key Authentication` + `# API_KEYS=` to backend/.env.example; added `apiKeys: string[]` to Config interface and parsed from env in config.ts. TypeScript compiles clean. PRD item 1 (setup/API_KEYS) complete. Next: implement validateApiKey utility in backend/src/auth/apiKey.ts.
2026-02-24: Created backend/src/auth/apiKey.ts — exports `API_KEY_HEADER = 'x-api-key'` and `validateApiKey(plainKey): Promise<boolean>` (iterates config.apiKeys, bcrypt.compare each). TypeScript compiles clean. PRD item 2 (API key validation utility) complete. Next: add getCiServiceAccountUser helper + CI_SERVICE_ACCOUNT_EMAIL config (PRD item 3).
2026-02-24: Added `getCiServiceAccountUser(prisma): Promise<req.user>` to backend/src/auth/apiKey.ts — looks up user by config.ciServiceAccountEmail, throws descriptive error if not found. Added `ciServiceAccountEmail` field to Config + `CI_SERVICE_ACCOUNT_EMAIL` env var (default: ci@excalidash.local) to config.ts and .env.example. TypeScript compiles clean. PRD item 3 complete. Next: wire API key check into requireAuth/optionalAuth middleware (PRD item 4).
2026-02-24: Wired X-API-Key middleware into /drawings/* routes. Added tryApiKeyAuth helper + requireAuthOrApiKey + optionalAuthOrApiKey to createAuthMiddleware (middleware/auth.ts). Added CSRF bypass for requests with x-api-key header (server/csrf.ts). Added x-api-key to CORS allowedHeaders. Updated DashboardRouteDeps types and drawings.ts to use the new middleware on GET /drawings, GET /drawings/:id, POST /drawings, PUT /drawings/:id. All existing tests pass (6 auth tests + 26 drawings integration tests). PRD item "Add X-API-Key middleware to ExcaliDash" is now complete. Next PRD item: Scaffold packages/sync-diagrams.
